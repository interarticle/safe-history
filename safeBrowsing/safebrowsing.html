<!DOCTYPE html>
<html>
<body>

<p>Click the button to test Google safe browsing API.</p>
<p id="gsb"></p>

<p>Click the button to test WOT API.</p>
<p id="wot"></p>

<button type="button" onclick="myFunction()">Try it</button>

<script src="../jquery-1.11.0.min.js"></script>

<script>
function getWOTRate(url_list) {
    return new Promise(function(resolve) {
        var params = "";
        for (var i = 0; i < url_list.length; i++) {
            params = params + url_list[i] + "/";
        }
        $.get(
            "http://api.mywot.com/0.4/public_link_json2?hosts=" + params + "&key=683b9b246d59621df5d3dd8ae88a69e7104c0bdf",
            function (data) {
                result = [];
                $.each(data, function(key, val) {
                    entry = {};
                    entry["site"] = val["target"];
                    var rate_sum = 0;
                    for (var i = 0; i < val["0"].length; i++) {
                        rate_sum += val["0"][i];
                    }
                    entry["wot_rate"] = Math.floor(rate_sum / val["0"].length);
                    // entry["wot_high_rate"] = val["0"][0];
                    // entry["wot_low_rate"] = val["0"][1];
                    result.push(entry);
                })
                resolve(result);
            },
            "json"
        )
    })
}

function getGoogleSafeBrowsingRate(url_list) {
    return new Promise(function(resolve) {
        var params = url_list.length;
        for (var i = 0; i < url_list.length; i++) {
            params = params + "\n" + url_list[i];
        }
        $.ajax({
            type: "POST",
            url: "https://sb-ssl.google.com/safebrowsing/api/lookup?client=firefox&apikey=ABQIAAAAnz8NMTU8sfDxwFqx36NDsRQ3PTNICuN5Fwsgomuke8FxMfY_PA&appver=1.5.2&pver=3.0",
            data: params
        }).done( function (data) {
            data = data.trim().split("\n")

            result = [];
            for (var i = 0; i < data.length; i++) {
                entry = {};
                entry["site"] = url_list[i];
                entry["google_rate"] = data[i];
                result.push(entry);
            }
            resolve(result);
        });
    })
}

function myFunction()
{
    // $.get(
    //     "http://api.mywot.com/0.4/public_link_json2?hosts=google.com/baidu.com/&key=683b9b246d59621df5d3dd8ae88a69e7104c0bdf",
    //     function (data) {
    //         document.getElementById("gsb").innerHTML = JSON.stringify(data[0]);
    //     },
    //     "json"
    // );
    var url_list = ["google.com", "baidu.com", "qq.com", "mitbbs.com", "tiexue.net", "h.acfun.tv", "whois.cymru.com", "ianfette.org"];
    getWOTRate(url_list).then(function(data) {
        // $.each(data, function(key, val) {
            // document.getElementById("wot").innerHTML += key + " " + JSON.stringify(data[key]) + "<br>";
        for (var i = 0; i < data.length; i++) {
            document.getElementById("wot").innerHTML += JSON.stringify(data[i]) + "<br>";
        }
    })
    // $.ajax({
    //     type: "POST",
    //     url: "https://sb-ssl.google.com/safebrowsing/api/lookup?client=firefox&apikey=ABQIAAAAnz8NMTU8sfDxwFqx36NDsRQ3PTNICuN5Fwsgomuke8FxMfY_PA&appver=1.5.2&pver=3.0",
    //     data: "2\ngoogle.com\nhttp://ianfette.org/"
    // }).done( function (data) {
    //     document.getElementById("gsb").innerHTML = data;
    // });
    getGoogleSafeBrowsingRate(url_list).then(function(data) {
        // document.getElementById("gsb").innerHTML = data;
        for (var i = 0; i < data.length; i++) {
            document.getElementById("gsb").innerHTML += JSON.stringify(data[i]) + "<br>";
        }
    })
}
</script>

</body>
</html> 
